let board = ['', '', '', '', '', '', '', '', ''];
let currentPlayer = 'X';
const aiPlayer = 'O';
const _cross = '<svg version="1.0" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="77.33 65.01 270.28 211.48" height="75px" width="75px" data-mark="X"> <g transform="translate(0.000000,380.000000) scale(0.100000,-0.100000)" fill=green stroke="none"><path xmlns="http://www.w3.org/2000/svg" d="M911 3133 c-1 -12 -5 -25 -11 -28 -5 -3 -10 -14 -10 -24 0 -10 -8 -33 -17 -52 -15 -29 -18 -31 -21 -13 -3 23 -67 50 -78 33 -7 -12 41 -59 60 -59 9 0 13 -6 10 -13 -2 -7 4 -22 16 -32 25 -23 25 -29 -1 -54 -19 -18 -19 -20 -3 -29 12 -6 15 -15 10 -28 -7 -18 -8 -18 -22 0 -17 24 -28 15 -19 -14 4 -13 12 -19 21 -16 8 3 14 2 14 -3 0 -5 16 -12 35 -15 19 -4 35 -11 35 -16 0 -6 -3 -10 -7 -10 -10 0 -10 -56 -1 -66 4 -4 5 -18 2 -31 -4 -13 -2 -23 2 -21 21 5 84 -14 84 -26 0 -7 -12 -18 -27 -25 -22 -10 -24 -14 -12 -22 11 -7 12 -11 1 -18 -8 -4 -12 -19 -10 -32 3 -25 38 -46 131 -80 57 -21 55 -10 -3 16 -26 12 -37 22 -31 28 6 6 28 -2 60 -22 28 -17 53 -31 56 -31 15 0 125 -57 167 -87 43 -31 47 -38 33 -46 -21 -11 -44 -29 -97 -76 -21 -18 -38 -30 -38 -26 0 3 -13 -7 -30 -23 -16 -17 -30 -34 -30 -38 0 -11 -58 -64 -70 -64 -6 0 -8 -4 -5 -10 3 -5 0 -10 -7 -10 -10 0 -10 -2 -1 -8 9 -5 3 -15 -18 -32 -55 -45 -78 -68 -72 -73 2 -3 -9 -13 -26 -22 -18 -9 -29 -20 -26 -25 3 -5 0 -12 -6 -16 -8 -4 -9 -3 -5 4 11 18 -10 14 -25 -5 -12 -14 -12 -16 1 -9 8 5 -18 -25 -57 -65 -40 -41 -73 -78 -73 -82 0 -5 10 -5 23 -2 14 4 17 3 9 -3 -7 -4 -14 -23 -17 -40 -3 -29 -2 -31 17 -21 15 8 19 8 14 0 -4 -6 -2 -11 3 -11 6 0 11 9 11 20 0 11 4 20 9 20 4 0 8 10 7 23 -1 16 5 22 19 22 11 0 20 5 20 10 1 23 24 48 46 50 13 2 33 7 44 11 18 7 19 6 6 -9 -8 -10 -16 -15 -19 -12 -3 2 -11 -3 -18 -13 -15 -20 -1 -52 22 -52 9 0 12 -5 8 -12 -5 -8 -2 -9 9 -5 12 5 17 1 17 -13 0 -27 5 -26 60 15 26 19 52 35 58 35 6 0 12 4 14 8 2 4 23 18 48 30 25 13 54 28 65 35 17 10 87 51 235 139 19 11 58 35 85 53 92 60 155 88 171 74 8 -6 17 -9 21 -5 3 3 1 6 -5 6 -19 0 -14 18 7 30 27 14 51 2 51 -25 0 -13 11 -30 25 -39 19 -13 24 -22 20 -37 -5 -15 1 -29 21 -50 15 -16 23 -29 17 -29 -6 0 -26 17 -45 38 -19 20 -42 44 -53 52 -17 14 -17 14 -7 -5 5 -11 24 -33 41 -49 17 -17 31 -34 31 -40 0 -6 -20 12 -45 39 -24 28 -44 45 -45 39 0 -6 50 -64 110 -129 61 -64 110 -122 110 -129 0 -6 15 -27 33 -46 17 -20 45 -51 60 -70 126 -156 135 -166 141 -159 4 3 -3 18 -15 33 -12 15 -19 29 -16 32 2 2 12 -7 21 -21 9 -14 60 -69 112 -123 53 -53 110 -116 127 -140 17 -23 33 -38 36 -34 10 15 35 0 70 -40 39 -45 63 -40 28 5 -13 18 -33 50 -45 72 -11 22 -46 74 -78 115 -32 40 -59 82 -59 91 -1 10 2 16 7 13 22 -14 3 13 -44 63 -57 58 -69 76 -45 67 15 -5 147 -166 147 -179 0 -3 -6 -3 -12 2 -7 4 9 -19 36 -50 27 -31 52 -57 56 -57 5 0 31 -30 58 -67 78 -107 212 -228 226 -205 7 11 -105 197 -176 293 -76 103 -149 216 -152 234 -1 9 -19 35 -39 58 -76 88 -217 278 -217 294 0 5 -11 24 -25 43 -13 18 -22 36 -20 40 3 4 -3 14 -13 21 -15 13 -16 12 -4 -3 8 -10 9 -18 3 -22 -11 -7 -75 73 -66 82 3 3 15 -3 27 -14 17 -14 19 -15 9 -2 -7 9 -9 23 -5 29 4 8 3 9 -4 5 -7 -4 -12 -1 -12 8 0 8 -6 19 -12 23 -7 5 -26 23 -43 41 -27 30 -28 35 -14 45 9 7 16 17 16 22 -1 6 10 12 24 15 13 3 62 25 109 49 47 24 99 47 115 51 17 5 57 18 90 30 40 15 65 19 74 13 10 -6 34 -4 68 7 61 19 84 36 33 25 -53 -11 -30 4 36 24 61 18 109 15 96 -5 -4 -7 -27 -17 -52 -24 -72 -18 -82 -22 -77 -27 3 -2 30 3 62 12 31 9 66 14 77 11 12 -3 49 1 82 9 34 8 89 15 124 15 46 0 64 4 68 15 5 11 11 12 24 5 10 -6 28 -10 40 -10 27 0 81 55 74 75 -6 16 -2 17 61 17 51 0 52 -1 31 -17 -11 -8 -16 -18 -13 -22 4 -3 19 4 33 18 22 20 25 30 21 63 -3 21 -16 50 -29 65 -13 14 -29 36 -36 49 -11 20 -10 22 12 22 13 0 26 -4 28 -10 2 -5 19 -10 38 -11 54 -2 100 -19 100 -36 0 -8 5 -12 12 -9 7 3 21 9 30 12 15 5 14 9 -9 32 -24 24 -24 26 -8 38 11 8 16 21 12 33 -3 12 1 22 10 25 8 3 11 11 8 16 -4 7 -11 8 -18 2 -7 -5 -28 -12 -47 -15 -19 -3 -70 -18 -112 -33 l-77 -29 -25 24 c-32 31 -24 45 15 26 36 -19 52 -11 46 21 -3 20 -1 23 17 19 13 -3 32 4 50 19 28 23 29 25 13 49 -9 14 -32 35 -52 47 -27 17 -33 25 -23 31 10 7 10 9 -3 9 -19 0 -112 -31 -119 -40 -3 -3 -20 -12 -38 -19 -30 -12 -34 -12 -51 8 -17 20 -58 31 -47 12 7 -10 -17 -21 -45 -21 -15 0 -19 5 -14 19 9 31 -21 33 -96 7 -38 -13 -66 -20 -63 -15 3 5 11 9 19 9 8 0 18 6 22 14 4 8 53 26 108 40 55 15 103 30 108 35 11 11 -128 -6 -152 -18 -26 -14 -34 -14 -29 1 3 7 39 20 82 28 77 15 102 37 36 31 -37 -3 -222 -49 -329 -82 -35 -10 -78 -19 -96 -19 -19 0 -36 -4 -39 -8 -3 -5 -19 -9 -35 -10 -28 -1 -91 -27 -91 -38 0 -3 5 -2 12 2 7 4 8 3 4 -5 -4 -6 -11 -9 -16 -6 -5 3 -28 -4 -50 -15 -22 -11 -45 -18 -51 -14 -6 3 -24 -3 -40 -15 -15 -11 -32 -21 -37 -21 -4 0 -13 -5 -20 -12 -15 -15 -83 -38 -94 -32 -5 3 -7 0 -6 -7 2 -6 -3 -14 -11 -17 -9 -3 -11 0 -6 8 4 6 -19 -3 -51 -21 -33 -18 -76 -42 -96 -53 -52 -27 -43 -29 23 -6 47 17 51 18 30 2 -14 -9 -59 -36 -101 -58 -87 -48 -85 -49 -144 38 -21 31 -62 82 -92 113 -49 51 -58 66 -55 87 0 3 -24 29 -53 56 -42 38 -49 49 -33 47 12 -2 46 -17 75 -35 29 -18 55 -30 59 -27 9 10 -60 89 -106 121 -40 28 -86 32 -133 12 -13 -6 -20 -2 -27 17 -11 27 -56 67 -77 67 -24 0 -15 -17 23 -49 32 -26 34 -31 17 -31 -12 0 -27 7 -34 15 -7 8 -16 12 -22 9 -5 -3 -15 0 -23 6 -12 10 -15 10 -15 -1 0 -18 20 -49 20 -32 0 7 7 10 15 7 24 -10 17 -19 -15 -21 -22 -2 -35 6 -54 28 -15 17 -26 36 -26 42 0 6 -8 3 -17 -7 -14 -14 -15 -20 -5 -23 10 -4 7 -9 -8 -20 -19 -13 -23 -13 -39 1 -10 9 -23 16 -29 16 -7 0 -12 9 -12 20 0 24 -6 25 -26 5 -21 -20 -37 -19 -52 5 -8 13 -8 20 -1 20 5 0 7 5 4 10 -10 16 -25 12 -25 -7 0 -15 -2 -15 -9 -4 -5 8 -16 11 -24 8 -9 -3 -18 -1 -21 6 -2 7 -5 2 -5 -10z"></path></g></svg>'
const _round = '<svg version="1.0" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="0.08 0.07 1278.53 1261.77" height="75px" width="75px" data-mark="O"> <g transform="translate(0.000000,1264.000000) scale(0.100000,-0.100000)" fill=red stroke="none"> <path d="M6180 12637 c-3 -2 -79 -10 -170 -16 -241 -17 -418 -39 -443 -55 -12 -8 -89 -22 -172 -31 -134 -14 -277 -43 -600 -120 -55 -13 -167 -45 -250 -70 -82 -26 -206 -64 -275 -85 -524 -162 -1124 -463 -1599 -804 -141 -101 -412 -311 -511 -395 -196 -167 -567 -526 -720 -697 -368 -411 -696 -903 -871 -1305 -22 -52 -67 -150 -99 -219 -205 -436 -371 -1023 -434 -1535 -9 -71 -21 -160 -26 -197 -18 -120 -8 -406 16 -478 5 -13 7 -13 15 1 14 26 46 167 84 377 33 177 51 251 59 241 1 -2 -3 -78 -10 -169 -13 -176 -18 -507 -8 -559 18 -86 48 2 79 224 61 453 87 628 111 744 35 171 113 453 183 661 74 220 76 224 51 171 -11 -23 -39 -95 -62 -160 -43 -119 -54 -141 -70 -141 -15 0 2 68 59 230 140 396 303 746 511 1093 87 145 109 174 124 159 7 -7 -6 -38 -40 -94 -60 -100 -126 -231 -201 -398 -31 -69 -66 -139 -77 -155 -40 -57 -66 -117 -69 -166 -2 -26 -26 -105 -54 -176 -28 -70 -61 -159 -75 -198 -89 -260 -149 -449 -179 -575 -57 -232 -149 -793 -140 -845 3 -14 -5 -69 -18 -123 -20 -82 -24 -122 -24 -264 0 -112 4 -171 11 -178 9 -9 13 6 18 59 3 39 9 102 12 140 5 54 10 70 23 74 27 7 64 152 121 472 76 429 150 736 185 765 19 16 19 7 3 -70 -10 -49 -9 -59 7 -83 9 -15 21 -24 26 -21 5 3 23 33 40 66 17 33 33 57 37 53 21 -20 27 -73 20 -173 -10 -138 1 -252 23 -252 12 0 30 44 101 250 60 175 73 204 88 195 5 -3 62 105 128 239 259 528 419 775 896 1386 236 302 626 727 626 683 0 -5 -40 -62 -90 -127 -123 -162 -181 -266 -147 -266 21 0 83 48 323 251 604 508 976 760 1488 1010 460 223 900 362 1421 449 269 44 461 61 755 67 624 13 1177 -69 1755 -262 657 -219 1216 -530 1760 -981 162 -135 499 -470 631 -629 714 -859 1125 -1833 1229 -2910 86 -890 -59 -1762 -443 -2655 -675 -1572 -2158 -2781 -3832 -3124 -1163 -239 -2225 -160 -3275 243 -71 28 -131 49 -132 47 -2 -2 49 -26 114 -54 555 -236 1155 -377 1808 -423 214 -15 723 -6 930 16 882 93 1691 367 2410 813 462 288 950 705 1324 1135 51 59 98 107 103 107 11 0 8 -5 -44 -82 -21 -31 -38 -65 -38 -75 0 -47 -460 -522 -710 -734 -392 -332 -812 -602 -1195 -769 -628 -273 -1268 -424 -1950 -460 -110 -5 -285 -15 -390 -22 -226 -15 -394 -13 -605 8 -688 66 -1346 259 -1990 585 -505 255 -923 545 -1370 951 -85 78 -130 115 -100 84 30 -32 109 -108 175 -170 871 -806 1957 -1309 3180 -1471 66 -9 143 -23 170 -30 119 -33 546 -42 1045 -20 111 5 113 4 71 -10 -63 -21 -280 -43 -548 -55 -360 -17 -801 8 -1143 66 -286 48 -664 155 -980 279 -1209 472 -2249 1355 -2921 2480 -46 77 -136 246 -201 375 -65 129 -118 231 -118 227 0 -18 129 -297 202 -436 310 -596 734 -1151 1210 -1587 237 -218 264 -244 253 -244 -51 -1 -613 537 -815 779 -326 394 -544 730 -812 1256 -86 171 -158 302 -158 293 0 -9 15 -61 34 -115 19 -54 40 -118 46 -143 19 -73 216 -427 398 -715 513 -809 1216 -1476 2077 -1970 207 -119 581 -305 730 -364 412 -162 914 -285 1425 -351 85 -11 193 -29 240 -40 47 -12 95 -23 108 -26 32 -7 27 -24 -8 -24 -44 0 -306 28 -435 46 -542 76 -1110 238 -1610 459 -615 272 -1194 664 -1684 1140 -222 217 -371 386 -568 648 -96 128 -179 234 -185 236 -31 11 92 -161 266 -374 114 -139 110 -134 102 -142 -3 -3 -29 13 -57 36 -27 24 -53 41 -55 38 -3 -3 6 -25 20 -50 57 -97 12 -59 -129 108 -181 215 -419 551 -560 788 -31 53 -59 97 -62 97 -11 0 133 -239 249 -414 432 -648 967 -1189 1681 -1700 851 -609 1824 -975 2872 -1082 203 -20 617 -31 850 -22 549 22 1084 122 1630 303 306 101 503 182 790 325 555 275 1085 636 1528 1043 66 60 121 106 124 103 3 -2 0 -20 -6 -39 -8 -24 -47 -66 -130 -141 -574 -516 -1191 -905 -1871 -1178 -1375 -553 -2930 -603 -4328 -140 -911 303 -1714 790 -2403 1460 -955 928 -1603 2152 -1818 3437 -11 66 -34 230 -51 365 -18 135 -33 247 -35 249 -25 24 -7 -290 30 -535 240 -1584 1033 -2960 2285 -3963 760 -609 1709 -1051 2675 -1246 396 -80 700 -113 1120 -122 735 -15 1426 87 2115 312 552 181 1043 417 1515 730 620 410 1128 891 1588 1504 162 215 259 361 383 578 587 1023 868 2113 852 3306 -1 147 0 267 3 267 23 0 36 -602 20 -865 -56 -873 -271 -1684 -652 -2456 -54 -110 -96 -199 -94 -199 8 0 139 254 202 394 102 221 168 392 253 646 318 954 405 1979 254 2970 -80 525 -209 979 -422 1492 -32 79 -80 202 -106 273 -126 346 -412 848 -715 1255 -384 515 -875 975 -1415 1325 -225 145 -739 405 -1031 520 -93 37 -240 95 -325 130 -668 274 -1412 417 -2250 432 -146 3 -267 3 -270 0z m-1975 -492 c-16 -8 -95 -42 -175 -76 -442 -187 -752 -353 -1151 -615 -402 -264 -759 -566 -1095 -926 -86 -92 -163 -173 -172 -180 -49 -41 88 145 209 283 188 213 626 579 984 822 408 276 1020 594 1315 683 87 27 133 31 85 9z m-870 -595 c-16 -16 -60 -49 -99 -72 -206 -121 -513 -341 -721 -515 -163 -136 -254 -222 -574 -540 -150 -150 -278 -273 -283 -273 -29 0 208 265 432 484 316 307 637 561 1022 805 114 73 233 140 247 141 3 0 -8 -13 -24 -30z m-2350 -3660 c3 -5 1 -10 -4 -10 -6 0 -11 5 -11 10 0 6 2 10 4 10 3 0 8 -4 11 -10z"></path> <path d="M616 8395 c-9 -26 -7 -32 5 -12 6 10 9 21 6 23 -2 3 -7 -2 -11 -11z"></path> <path d="M1090 4025 c0 -5 5 -17 10 -25 5 -8 10 -10 10 -5 0 6 -5 17 -10 25 -5 8 -10 11 -10 5z"></path> <path d="M1060 3350 c6 -11 13 -20 16 -20 2 0 0 9 -6 20 -6 11 -13 20 -16 20 -2 0 0 -9 6 -20z"></path> </g> </svg>'

const winCombinations = [
  [0, 1, 2],
  [3, 4, 5],
  [6, 7, 8],
  [0, 3, 6],
  [1, 4, 7],
  [2, 5, 8],
  [0, 4, 8],
  [2, 4, 6]
];

function makeMove(index) {
  if (board[index] === '') {
    board[index] = currentPlayer;
    const cell = document.getElementsByClassName('cell')[index];
    if (currentPlayer === 'X') {
      cell.innerHTML = _cross
      cell.classList.add('cross')
    } else {
      cell.innerHTML = _round
      cell.classList.add('round')
    }

    if (checkWin(currentPlayer)) {
      highlightWinningCells();
      setTimeout(() => {
        alert('Player ' + currentPlayer + ' wins!');
        resetBoard();
      }, 100);
    } else if (board.indexOf('') === -1) {
      setTimeout(() => {
        alert("It's a draw!");
        resetBoard();
      }, 100);
    } else {
      currentPlayer = currentPlayer === 'X' ? aiPlayer : 'X';
      if (currentPlayer === aiPlayer) {
        setTimeout(makeAiMove, 500);
      }
    }
  }
}

function makeAiMove() {
  const bestMove = getBestMove();
  makeMove(bestMove);
}

function getBestMove() {
  let bestScore = -Infinity;
  let bestMove;

  for (let i = 0; i < 9; i++) {
    if (board[i] === '') {
      board[i] = aiPlayer;
      const score = minimax(board, 0, false);
      board[i] = '';

      if (score > bestScore) {
        bestScore = score;
        bestMove = i;
      }
    }
  }

  return bestMove;
}

function minimax(board, depth, isMaximizing) {
  const scores = {
    X: -1,
    O: 1,
    draw: 0
  };

  if (checkWin(aiPlayer)) {
    return scores[aiPlayer];
  } else if (checkWin('X')) {
    return scores['X'];
  } else if (board.indexOf('') === -1) {
    return scores['draw'];
  }

  if (isMaximizing) {
    let bestScore = -Infinity;

    for (let i = 0; i < 9; i++) {
      if (board[i] === '') {
        board[i] = aiPlayer;
        const score = minimax(board, depth + 1, false);
        board[i] = '';

        bestScore = Math.max(score, bestScore);
      }
    }

    return bestScore;
  } else {
    let bestScore = Infinity;

    for (let i = 0; i < 9; i++) {
      if (board[i] === '') {
        board[i] = 'X';
        const score = minimax(board, depth + 1, true);
        board[i] = '';

        bestScore = Math.min(score, bestScore);
      }
    }
    return bestScore;
  }
}

function checkWin(player) {
  return winCombinations.some(combination => {
    return combination.every(index => board[index] === player);
  });
}

function highlightWinningCells() {
  for (const combination of winCombinations) {
    const [a, b, c] = combination;
    const cells = document.getElementsByClassName('cell');
    if (board[a] !== '' && board[a] === board[b] && board[a] === board[c]) {
      cells[a].classList.add('winning-cell');
      cells[b].classList.add('winning-cell');
      cells[c].classList.add('winning-cell');
      break;
    }
  }
}

function resetBoard() {
  board = ['', '', '', '', '', '', '', '', ''];
  currentPlayer = 'X';
  const cells = document.getElementsByClassName('cell');
  for (let i = 0; i < cells.length; i++) {
    cells[i].innerHTML = '';
    cells[i].classList.remove('X');
    cells[i].classList.remove('O');
    cells[i].classList.remove('winning-cell');
    cells[i].classList.remove('cross');
    cells[i].classList.remove('round');

  }
}
